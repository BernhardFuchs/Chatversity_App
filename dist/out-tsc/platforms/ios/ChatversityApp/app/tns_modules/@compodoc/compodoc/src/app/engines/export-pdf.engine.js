"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var fs = require("fs-extra");
var _ = require("lodash");
var path = require("path");
var configuration_1 = require("../configuration");
var markdown_to_pdf_engine_1 = require("./markdown-to-pdf.engine");
var PdfPrinter = require('pdfmake');
var ExportPdfEngine = /** @class */ (function () {
    function ExportPdfEngine() {
    }
    ExportPdfEngine.getInstance = function () {
        if (!ExportPdfEngine.instance) {
            ExportPdfEngine.instance = new ExportPdfEngine();
        }
        return ExportPdfEngine.instance;
    };
    ExportPdfEngine.prototype.export = function (outputFolder) {
        var fonts = {
            Roboto: {
                normal: path.join(__dirname, '../src/resources/fonts/roboto-v15-latin-regular.ttf'),
                bold: path.join(__dirname, '../src/resources/fonts/roboto-v15-latin-700.ttf')
            }
        };
        var printer = new PdfPrinter(fonts);
        var docDefinition = {
            info: {
                title: configuration_1.default.mainData.documentationMainName
            },
            content: [],
            styles: {
                header: {
                    fontSize: 18,
                    bold: true,
                    color: '#008cff',
                    margin: [0, 0, 0, 15]
                },
                subheader: {
                    fontSize: 15,
                    bold: true
                }
            }
        };
        docDefinition.content.push({
            text: configuration_1.default.mainData.documentationMainName,
            alignment: 'center',
            bold: true,
            fontSize: 22,
            margin: [10, 350, 10, 300]
        });
        if (!configuration_1.default.mainData.hideGenerator) {
            docDefinition.content.push({
                text: 'Documentation generated using',
                alignment: 'center'
            });
            docDefinition.content.push({
                image: "data:image/jpeg;base64,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",
                width: 70,
                alignment: 'center',
                pageBreak: 'after'
            });
        }
        docDefinition.content.push({
            toc: {
                title: {
                    text: 'Table of contents',
                    bold: true,
                    alignment: 'center',
                    fontSize: 18,
                    margin: [10, 10, 10, 50]
                },
                numberStyle: {
                    bold: true
                }
            },
            pageBreak: 'after'
        });
        // Add README page if available
        docDefinition.content.push(this.generateMarkdownContent());
        // Add CHANGELOG page if available
        // Add CONTRIBUTING page if available
        // Add LICENSE page if available
        // Add TODO page if available
        // Add Dependencies page if available
        // Add Additional pages if available
        docDefinition.content.push(this.generateModulesContent());
        docDefinition.content.push(this.generateComponentsContent());
        // Classes
        // Injectables
        // Interceptors
        // Guards
        // Interfaces
        // Pipes
        // Miscellaneous
        // Routes
        // Coverage - docDefinition.content.push(...this.coverageEngine.calculateTable());
        var pdfDoc = printer.createPdfKitDocument(docDefinition);
        return new Promise(function (resolve, reject) {
            fs.ensureFile(outputFolder + path.sep + 'documentation.pdf', function (err) {
                if (err) {
                    reject("Error during pdf generation: " + err);
                }
                else {
                    pdfDoc.pipe(fs.createWriteStream(outputFolder + path.sep + 'documentation.pdf'));
                    pdfDoc.end();
                    resolve();
                }
            });
        });
    };
    ExportPdfEngine.prototype.firstCharacterUpperCase = function (sentence) {
        return sentence.charAt(0).toUpperCase() + sentence.slice(1);
    };
    ExportPdfEngine.prototype.generateMarkdownContent = function () {
        var _this = this;
        var pages = configuration_1.default.markDownPages;
        var data = [];
        pages.forEach(function (page) {
            data.push({
                text: "" + _this.firstCharacterUpperCase(page.name),
                tocItem: true,
                style: 'header'
            });
            data.push({
                text: markdown_to_pdf_engine_1.default.convert(page.markdown),
                margin: [0, 10]
            });
        });
        this.insertPageReturn(data);
        return data;
    };
    ExportPdfEngine.prototype.insertPageReturn = function (data) {
        data.push({
            text: " ",
            margin: [0, 0, 0, 20],
            pageBreak: 'after'
        });
    };
    ExportPdfEngine.prototype.generateModulesContent = function () {
        var data = [];
        data.push({
            text: 'Modules',
            tocItem: true,
            style: 'header'
        });
        _.forEach(configuration_1.default.mainData.modules, function (module) {
            data.push({
                text: "" + module.name,
                style: 'subheader',
                margin: [0, 15, 0, 15]
            });
            data.push({
                text: [
                    {
                        text: "Filename : ",
                        bold: true
                    },
                    {
                        text: module.file
                    }
                ],
                margin: [0, 10]
            });
            if (module.rawdescription != '') {
                data.push({
                    text: "Description :",
                    bold: true,
                    margin: [0, 10]
                });
                data.push({
                    text: "" + module.rawdescription,
                    margin: [0, 5]
                });
            }
            if (module.declarations.length > 0) {
                data.push({
                    text: "Declarations :",
                    bold: true,
                    margin: [0, 10]
                });
                var list_1 = { ul: [] };
                _.forEach(module.declarations, function (declaration) {
                    list_1.ul.push({
                        text: "" + declaration.name
                    });
                });
                data.push(list_1);
            }
            if (module.providers.length > 0) {
                data.push({
                    text: "Providers :",
                    bold: true,
                    margin: [0, 10]
                });
                var list_2 = { ul: [] };
                _.forEach(module.providers, function (provider) {
                    list_2.ul.push({
                        text: "" + provider.name
                    });
                });
                data.push(list_2);
            }
            if (module.imports.length > 0) {
                data.push({
                    text: "Imports :",
                    bold: true,
                    margin: [0, 10]
                });
                var list_3 = { ul: [] };
                _.forEach(module.imports, function (importRef) {
                    list_3.ul.push({
                        text: "" + importRef.name
                    });
                });
                data.push(list_3);
            }
            if (module.exports.length > 0) {
                data.push({
                    text: "Exports :",
                    bold: true,
                    margin: [0, 10]
                });
                var list_4 = { ul: [] };
                _.forEach(module.exports, function (exportRef) {
                    list_4.ul.push({
                        text: "" + exportRef.name
                    });
                });
                data.push(list_4);
            }
            data.push({
                text: " ",
                margin: [0, 0, 0, 20]
            });
        });
        this.insertPageReturn(data);
        return data;
    };
    ExportPdfEngine.prototype.generateComponentsContent = function () {
        var data = [];
        data.push({
            text: 'Components',
            tocItem: true,
            style: 'header'
        });
        _.forEach(configuration_1.default.mainData.components, function (component) {
            data.push({
                text: "" + component.name,
                style: 'subheader',
                margin: [0, 15, 0, 15]
            });
            data.push({
                text: [
                    {
                        text: "Filename : ",
                        bold: true
                    },
                    {
                        text: component.file
                    }
                ],
                margin: [0, 10]
            });
            if (component.rawdescription != '') {
                data.push({
                    text: "Description :",
                    bold: true,
                    margin: [0, 10]
                });
                data.push({
                    text: "" + component.rawdescription,
                    margin: [0, 5]
                });
            }
            data.push({
                text: " ",
                margin: [0, 0, 0, 20]
            });
        });
        this.insertPageReturn(data);
        return data;
    };
    return ExportPdfEngine;
}());
exports.ExportPdfEngine = ExportPdfEngine;
exports.default = ExportPdfEngine.getInstance();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZXhwb3J0LXBkZi5lbmdpbmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wbGF0Zm9ybXMvaW9zL0NoYXR2ZXJzaXR5QXBwL2FwcC90bnNfbW9kdWxlcy9AY29tcG9kb2MvY29tcG9kb2Mvc3JjL2FwcC9lbmdpbmVzL2V4cG9ydC1wZGYuZW5naW5lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7O0FBQUEsNkJBQStCO0FBQy9CLDBCQUE0QjtBQUM1QiwyQkFBNkI7QUFFN0Isa0RBQTZDO0FBQzdDLG1FQUEyRDtBQUUzRCxJQUFNLFVBQVUsR0FBRyxPQUFPLENBQUMsU0FBUyxDQUFDLENBQUM7QUFFdEM7SUFFSTtJQUF1QixDQUFDO0lBQ1YsMkJBQVcsR0FBekI7UUFDSSxJQUFJLENBQUMsZUFBZSxDQUFDLFFBQVEsRUFBRTtZQUMzQixlQUFlLENBQUMsUUFBUSxHQUFHLElBQUksZUFBZSxFQUFFLENBQUM7U0FDcEQ7UUFDRCxPQUFPLGVBQWUsQ0FBQyxRQUFRLENBQUM7SUFDcEMsQ0FBQztJQUVNLGdDQUFNLEdBQWIsVUFBYyxZQUFZO1FBQ3RCLElBQUksS0FBSyxHQUFHO1lBQ1IsTUFBTSxFQUFFO2dCQUNKLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLFNBQVMsRUFBRSxxREFBcUQsQ0FBQztnQkFDbkYsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxFQUFFLGlEQUFpRCxDQUFDO2FBQ2hGO1NBQ0osQ0FBQztRQUVGLElBQUksT0FBTyxHQUFHLElBQUksVUFBVSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBRXBDLElBQUksYUFBYSxHQUFHO1lBQ2hCLElBQUksRUFBRTtnQkFDRixLQUFLLEVBQUUsdUJBQWEsQ0FBQyxRQUFRLENBQUMscUJBQXFCO2FBQ3REO1lBQ0QsT0FBTyxFQUFFLEVBQUU7WUFDWCxNQUFNLEVBQUU7Z0JBQ0osTUFBTSxFQUFFO29CQUNKLFFBQVEsRUFBRSxFQUFFO29CQUNaLElBQUksRUFBRSxJQUFJO29CQUNWLEtBQUssRUFBRSxTQUFTO29CQUNoQixNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7aUJBQ3hCO2dCQUNELFNBQVMsRUFBRTtvQkFDUCxRQUFRLEVBQUUsRUFBRTtvQkFDWixJQUFJLEVBQUUsSUFBSTtpQkFDYjthQUNKO1NBQ0osQ0FBQztRQUVGLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO1lBQ3ZCLElBQUksRUFBRSx1QkFBYSxDQUFDLFFBQVEsQ0FBQyxxQkFBcUI7WUFDbEQsU0FBUyxFQUFFLFFBQVE7WUFDbkIsSUFBSSxFQUFFLElBQUk7WUFDVixRQUFRLEVBQUUsRUFBRTtZQUNaLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRSxFQUFFLEdBQUcsQ0FBQztTQUM3QixDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsdUJBQWEsQ0FBQyxRQUFRLENBQUMsYUFBYSxFQUFFO1lBQ3ZDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDO2dCQUN2QixJQUFJLEVBQUUsK0JBQStCO2dCQUNyQyxTQUFTLEVBQUUsUUFBUTthQUN0QixDQUFDLENBQUM7WUFDSCxhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQztnQkFDdkIsS0FBSyxFQUFFLHlsS0FBeWxLO2dCQUNobUssS0FBSyxFQUFFLEVBQUU7Z0JBQ1QsU0FBUyxFQUFFLFFBQVE7Z0JBQ25CLFNBQVMsRUFBRSxPQUFPO2FBQ3JCLENBQUMsQ0FBQztTQUNOO1FBRUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUM7WUFDdkIsR0FBRyxFQUFFO2dCQUNELEtBQUssRUFBRTtvQkFDSCxJQUFJLEVBQUUsbUJBQW1CO29CQUN6QixJQUFJLEVBQUUsSUFBSTtvQkFDVixTQUFTLEVBQUUsUUFBUTtvQkFDbkIsUUFBUSxFQUFFLEVBQUU7b0JBQ1osTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsRUFBRSxDQUFDO2lCQUMzQjtnQkFDRCxXQUFXLEVBQUU7b0JBQ1QsSUFBSSxFQUFFLElBQUk7aUJBQ2I7YUFDSjtZQUNELFNBQVMsRUFBRSxPQUFPO1NBQ3JCLENBQUMsQ0FBQztRQUVILCtCQUErQjtRQUUvQixhQUFhLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsdUJBQXVCLEVBQUUsQ0FBQyxDQUFDO1FBRTNELGtDQUFrQztRQUVsQyxxQ0FBcUM7UUFFckMsZ0NBQWdDO1FBRWhDLDZCQUE2QjtRQUU3QixxQ0FBcUM7UUFFckMsb0NBQW9DO1FBRXBDLGFBQWEsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxzQkFBc0IsRUFBRSxDQUFDLENBQUM7UUFFMUQsYUFBYSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLHlCQUF5QixFQUFFLENBQUMsQ0FBQztRQUU3RCxVQUFVO1FBRVYsY0FBYztRQUVkLGVBQWU7UUFFZixTQUFTO1FBRVQsYUFBYTtRQUViLFFBQVE7UUFFUixnQkFBZ0I7UUFFaEIsU0FBUztRQUVULGtGQUFrRjtRQUVsRixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsb0JBQW9CLENBQUMsYUFBYSxDQUFDLENBQUM7UUFFekQsT0FBTyxJQUFJLE9BQU8sQ0FBQyxVQUFDLE9BQU8sRUFBRSxNQUFNO1lBQy9CLEVBQUUsQ0FBQyxVQUFVLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxHQUFHLEdBQUcsbUJBQW1CLEVBQUUsVUFBQSxHQUFHO2dCQUM1RCxJQUFJLEdBQUcsRUFBRTtvQkFDTCxNQUFNLENBQUMsa0NBQWdDLEdBQUssQ0FBQyxDQUFDO2lCQUNqRDtxQkFBTTtvQkFDSCxNQUFNLENBQUMsSUFBSSxDQUNQLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDLEdBQUcsR0FBRyxtQkFBbUIsQ0FBQyxDQUN0RSxDQUFDO29CQUNGLE1BQU0sQ0FBQyxHQUFHLEVBQUUsQ0FBQztvQkFDYixPQUFPLEVBQUUsQ0FBQztpQkFDYjtZQUNMLENBQUMsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7SUFDUCxDQUFDO0lBRU8saURBQXVCLEdBQS9CLFVBQWdDLFFBQWdCO1FBQzVDLE9BQU8sUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDLENBQUMsQ0FBQyxXQUFXLEVBQUUsR0FBRyxRQUFRLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQ2hFLENBQUM7SUFFTyxpREFBdUIsR0FBL0I7UUFBQSxpQkFvQkM7UUFuQkcsSUFBSSxLQUFLLEdBQUcsdUJBQWEsQ0FBQyxhQUFhLENBQUM7UUFFeEMsSUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFDO1FBRWQsS0FBSyxDQUFDLE9BQU8sQ0FBQyxVQUFBLElBQUk7WUFDZCxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUNOLElBQUksRUFBRSxLQUFHLEtBQUksQ0FBQyx1QkFBdUIsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFHO2dCQUNsRCxPQUFPLEVBQUUsSUFBSTtnQkFDYixLQUFLLEVBQUUsUUFBUTthQUNsQixDQUFDLENBQUM7WUFDSCxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUNOLElBQUksRUFBRSxnQ0FBbUIsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztnQkFDaEQsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQzthQUNsQixDQUFDLENBQUM7UUFDUCxDQUFDLENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUU1QixPQUFPLElBQUksQ0FBQztJQUNoQixDQUFDO0lBRU8sMENBQWdCLEdBQXhCLFVBQXlCLElBQUk7UUFDekIsSUFBSSxDQUFDLElBQUksQ0FBQztZQUNOLElBQUksRUFBRSxHQUFHO1lBQ1QsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO1lBQ3JCLFNBQVMsRUFBRSxPQUFPO1NBQ3JCLENBQUMsQ0FBQztJQUNQLENBQUM7SUFFTyxnREFBc0IsR0FBOUI7UUFDSSxJQUFJLElBQUksR0FBRyxFQUFFLENBQUM7UUFFZCxJQUFJLENBQUMsSUFBSSxDQUFDO1lBQ04sSUFBSSxFQUFFLFNBQVM7WUFDZixPQUFPLEVBQUUsSUFBSTtZQUNiLEtBQUssRUFBRSxRQUFRO1NBQ2xCLENBQUMsQ0FBQztRQUVILENBQUMsQ0FBQyxPQUFPLENBQUMsdUJBQWEsQ0FBQyxRQUFRLENBQUMsT0FBTyxFQUFFLFVBQUEsTUFBTTtZQUM1QyxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUNOLElBQUksRUFBRSxLQUFHLE1BQU0sQ0FBQyxJQUFNO2dCQUN0QixLQUFLLEVBQUUsV0FBVztnQkFDbEIsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2FBQ3pCLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ04sSUFBSSxFQUFFO29CQUNGO3dCQUNJLElBQUksRUFBRSxhQUFhO3dCQUNuQixJQUFJLEVBQUUsSUFBSTtxQkFDYjtvQkFDRDt3QkFDSSxJQUFJLEVBQUUsTUFBTSxDQUFDLElBQUk7cUJBQ3BCO2lCQUNKO2dCQUNELE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7YUFDbEIsQ0FBQyxDQUFDO1lBRUgsSUFBSSxNQUFNLENBQUMsY0FBYyxJQUFJLEVBQUUsRUFBRTtnQkFDN0IsSUFBSSxDQUFDLElBQUksQ0FBQztvQkFDTixJQUFJLEVBQUUsZUFBZTtvQkFDckIsSUFBSSxFQUFFLElBQUk7b0JBQ1YsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztpQkFDbEIsQ0FBQyxDQUFDO2dCQUVILElBQUksQ0FBQyxJQUFJLENBQUM7b0JBQ04sSUFBSSxFQUFFLEtBQUcsTUFBTSxDQUFDLGNBQWdCO29CQUNoQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2lCQUNqQixDQUFDLENBQUM7YUFDTjtZQUVELElBQUksTUFBTSxDQUFDLFlBQVksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO2dCQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDO29CQUNOLElBQUksRUFBRSxnQkFBZ0I7b0JBQ3RCLElBQUksRUFBRSxJQUFJO29CQUNWLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7aUJBQ2xCLENBQUMsQ0FBQztnQkFFSCxJQUFJLE1BQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztnQkFFdEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsWUFBWSxFQUFFLFVBQUEsV0FBVztvQkFDdEMsTUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUM7d0JBQ1QsSUFBSSxFQUFFLEtBQUcsV0FBVyxDQUFDLElBQU07cUJBQzlCLENBQUMsQ0FBQztnQkFDUCxDQUFDLENBQUMsQ0FBQztnQkFFSCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQUksQ0FBQyxDQUFDO2FBQ25CO1lBRUQsSUFBSSxNQUFNLENBQUMsU0FBUyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzdCLElBQUksQ0FBQyxJQUFJLENBQUM7b0JBQ04sSUFBSSxFQUFFLGFBQWE7b0JBQ25CLElBQUksRUFBRSxJQUFJO29CQUNWLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7aUJBQ2xCLENBQUMsQ0FBQztnQkFFSCxJQUFJLE1BQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztnQkFFdEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLFVBQUEsUUFBUTtvQkFDaEMsTUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUM7d0JBQ1QsSUFBSSxFQUFFLEtBQUcsUUFBUSxDQUFDLElBQU07cUJBQzNCLENBQUMsQ0FBQztnQkFDUCxDQUFDLENBQUMsQ0FBQztnQkFFSCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQUksQ0FBQyxDQUFDO2FBQ25CO1lBRUQsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzNCLElBQUksQ0FBQyxJQUFJLENBQUM7b0JBQ04sSUFBSSxFQUFFLFdBQVc7b0JBQ2pCLElBQUksRUFBRSxJQUFJO29CQUNWLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7aUJBQ2xCLENBQUMsQ0FBQztnQkFFSCxJQUFJLE1BQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztnQkFFdEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLFVBQUEsU0FBUztvQkFDL0IsTUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUM7d0JBQ1QsSUFBSSxFQUFFLEtBQUcsU0FBUyxDQUFDLElBQU07cUJBQzVCLENBQUMsQ0FBQztnQkFDUCxDQUFDLENBQUMsQ0FBQztnQkFFSCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQUksQ0FBQyxDQUFDO2FBQ25CO1lBRUQsSUFBSSxNQUFNLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQUU7Z0JBQzNCLElBQUksQ0FBQyxJQUFJLENBQUM7b0JBQ04sSUFBSSxFQUFFLFdBQVc7b0JBQ2pCLElBQUksRUFBRSxJQUFJO29CQUNWLE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7aUJBQ2xCLENBQUMsQ0FBQztnQkFFSCxJQUFJLE1BQUksR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsQ0FBQztnQkFFdEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsT0FBTyxFQUFFLFVBQUEsU0FBUztvQkFDL0IsTUFBSSxDQUFDLEVBQUUsQ0FBQyxJQUFJLENBQUM7d0JBQ1QsSUFBSSxFQUFFLEtBQUcsU0FBUyxDQUFDLElBQU07cUJBQzVCLENBQUMsQ0FBQztnQkFDUCxDQUFDLENBQUMsQ0FBQztnQkFFSCxJQUFJLENBQUMsSUFBSSxDQUFDLE1BQUksQ0FBQyxDQUFDO2FBQ25CO1lBRUQsSUFBSSxDQUFDLElBQUksQ0FBQztnQkFDTixJQUFJLEVBQUUsR0FBRztnQkFDVCxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7YUFDeEIsQ0FBQyxDQUFDO1FBQ1AsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLENBQUMsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLENBQUM7UUFFNUIsT0FBTyxJQUFJLENBQUM7SUFDaEIsQ0FBQztJQUVPLG1EQUF5QixHQUFqQztRQUNJLElBQUksSUFBSSxHQUFHLEVBQUUsQ0FBQztRQUVkLElBQUksQ0FBQyxJQUFJLENBQUM7WUFDTixJQUFJLEVBQUUsWUFBWTtZQUNsQixPQUFPLEVBQUUsSUFBSTtZQUNiLEtBQUssRUFBRSxRQUFRO1NBQ2xCLENBQUMsQ0FBQztRQUVILENBQUMsQ0FBQyxPQUFPLENBQUMsdUJBQWEsQ0FBQyxRQUFRLENBQUMsVUFBVSxFQUFFLFVBQUEsU0FBUztZQUNsRCxJQUFJLENBQUMsSUFBSSxDQUFDO2dCQUNOLElBQUksRUFBRSxLQUFHLFNBQVMsQ0FBQyxJQUFNO2dCQUN6QixLQUFLLEVBQUUsV0FBVztnQkFDbEIsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2FBQ3pCLENBQUMsQ0FBQztZQUVILElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ04sSUFBSSxFQUFFO29CQUNGO3dCQUNJLElBQUksRUFBRSxhQUFhO3dCQUNuQixJQUFJLEVBQUUsSUFBSTtxQkFDYjtvQkFDRDt3QkFDSSxJQUFJLEVBQUUsU0FBUyxDQUFDLElBQUk7cUJBQ3ZCO2lCQUNKO2dCQUNELE1BQU0sRUFBRSxDQUFDLENBQUMsRUFBRSxFQUFFLENBQUM7YUFDbEIsQ0FBQyxDQUFDO1lBRUgsSUFBSSxTQUFTLENBQUMsY0FBYyxJQUFJLEVBQUUsRUFBRTtnQkFDaEMsSUFBSSxDQUFDLElBQUksQ0FBQztvQkFDTixJQUFJLEVBQUUsZUFBZTtvQkFDckIsSUFBSSxFQUFFLElBQUk7b0JBQ1YsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQztpQkFDbEIsQ0FBQyxDQUFDO2dCQUVILElBQUksQ0FBQyxJQUFJLENBQUM7b0JBQ04sSUFBSSxFQUFFLEtBQUcsU0FBUyxDQUFDLGNBQWdCO29CQUNuQyxNQUFNLEVBQUUsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO2lCQUNqQixDQUFDLENBQUM7YUFDTjtZQUVELElBQUksQ0FBQyxJQUFJLENBQUM7Z0JBQ04sSUFBSSxFQUFFLEdBQUc7Z0JBQ1QsTUFBTSxFQUFFLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUUsRUFBRSxDQUFDO2FBQ3hCLENBQUMsQ0FBQztRQUNQLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxDQUFDLGdCQUFnQixDQUFDLElBQUksQ0FBQyxDQUFDO1FBRTVCLE9BQU8sSUFBSSxDQUFDO0lBQ2hCLENBQUM7SUFDTCxzQkFBQztBQUFELENBQUMsQUF0VkQsSUFzVkM7QUF0VlksMENBQWU7QUF3VjVCLGtCQUFlLGVBQWUsQ0FBQyxXQUFXLEVBQUUsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcbmltcG9ydCAqIGFzIHBhdGggZnJvbSAncGF0aCc7XG5cbmltcG9ydCBDb25maWd1cmF0aW9uIGZyb20gJy4uL2NvbmZpZ3VyYXRpb24nO1xuaW1wb3J0IE1hcmtkb3duVG9QZGZFbmdpbmUgZnJvbSAnLi9tYXJrZG93bi10by1wZGYuZW5naW5lJztcblxuY29uc3QgUGRmUHJpbnRlciA9IHJlcXVpcmUoJ3BkZm1ha2UnKTtcblxuZXhwb3J0IGNsYXNzIEV4cG9ydFBkZkVuZ2luZSB7XG4gICAgcHJpdmF0ZSBzdGF0aWMgaW5zdGFuY2U6IEV4cG9ydFBkZkVuZ2luZTtcbiAgICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge31cbiAgICBwdWJsaWMgc3RhdGljIGdldEluc3RhbmNlKCkge1xuICAgICAgICBpZiAoIUV4cG9ydFBkZkVuZ2luZS5pbnN0YW5jZSkge1xuICAgICAgICAgICAgRXhwb3J0UGRmRW5naW5lLmluc3RhbmNlID0gbmV3IEV4cG9ydFBkZkVuZ2luZSgpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBFeHBvcnRQZGZFbmdpbmUuaW5zdGFuY2U7XG4gICAgfVxuXG4gICAgcHVibGljIGV4cG9ydChvdXRwdXRGb2xkZXIpIHtcbiAgICAgICAgbGV0IGZvbnRzID0ge1xuICAgICAgICAgICAgUm9ib3RvOiB7XG4gICAgICAgICAgICAgICAgbm9ybWFsOiBwYXRoLmpvaW4oX19kaXJuYW1lLCAnLi4vc3JjL3Jlc291cmNlcy9mb250cy9yb2JvdG8tdjE1LWxhdGluLXJlZ3VsYXIudHRmJyksXG4gICAgICAgICAgICAgICAgYm9sZDogcGF0aC5qb2luKF9fZGlybmFtZSwgJy4uL3NyYy9yZXNvdXJjZXMvZm9udHMvcm9ib3RvLXYxNS1sYXRpbi03MDAudHRmJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgcHJpbnRlciA9IG5ldyBQZGZQcmludGVyKGZvbnRzKTtcblxuICAgICAgICBsZXQgZG9jRGVmaW5pdGlvbiA9IHtcbiAgICAgICAgICAgIGluZm86IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogQ29uZmlndXJhdGlvbi5tYWluRGF0YS5kb2N1bWVudGF0aW9uTWFpbk5hbWVcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBjb250ZW50OiBbXSxcbiAgICAgICAgICAgIHN0eWxlczoge1xuICAgICAgICAgICAgICAgIGhlYWRlcjoge1xuICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTgsXG4gICAgICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIGNvbG9yOiAnIzAwOGNmZicsXG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogWzAsIDAsIDAsIDE1XVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgc3ViaGVhZGVyOiB7XG4gICAgICAgICAgICAgICAgICAgIGZvbnRTaXplOiAxNSxcbiAgICAgICAgICAgICAgICAgICAgYm9sZDogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBkb2NEZWZpbml0aW9uLmNvbnRlbnQucHVzaCh7XG4gICAgICAgICAgICB0ZXh0OiBDb25maWd1cmF0aW9uLm1haW5EYXRhLmRvY3VtZW50YXRpb25NYWluTmFtZSxcbiAgICAgICAgICAgIGFsaWdubWVudDogJ2NlbnRlcicsXG4gICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgZm9udFNpemU6IDIyLFxuICAgICAgICAgICAgbWFyZ2luOiBbMTAsIDM1MCwgMTAsIDMwMF1cbiAgICAgICAgfSk7XG5cbiAgICAgICAgaWYgKCFDb25maWd1cmF0aW9uLm1haW5EYXRhLmhpZGVHZW5lcmF0b3IpIHtcbiAgICAgICAgICAgIGRvY0RlZmluaXRpb24uY29udGVudC5wdXNoKHtcbiAgICAgICAgICAgICAgICB0ZXh0OiAnRG9jdW1lbnRhdGlvbiBnZW5lcmF0ZWQgdXNpbmcnLFxuICAgICAgICAgICAgICAgIGFsaWdubWVudDogJ2NlbnRlcidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgZG9jRGVmaW5pdGlvbi5jb250ZW50LnB1c2goe1xuICAgICAgICAgICAgICAgIGltYWdlOiBgZGF0YTppbWFnZS9qcGVnO2Jhc2U2NCwvOWovNEFBUVNrWkpSZ0FCQWdBQVpBQmtBQUQvN0FBUlJIVmphM2tBQVFBRUFBQUFVZ0FBLys0QUprRmtiMkpsQUdUQUFBQUFBUU1BRlFRREJnb05BQUFFcUFBQUIrMEFBQXI3QUFBUExmL2JBSVFBQWdFQkFRSUJBZ0lDQWdNQ0FnSURCQU1DQWdNRUJBTURCQU1EQkFVRUJRVUZCUVFGQlFZSEJ3Y0dCUWtKQ1FrSkNRd01EQXdNREF3TURBd01EQXdNREFFQ0FnSUVCQVFJQlFVSURBa0lDUXdPRGc0T0RnNE9EQXdNREF3T0Rnd01EQXdNREE0TURBd01EQXdNREF3TURBd01EQXdNREF3TURBd01EQXdNREF3TS84SUFFUWdBUmdCR0F3RVJBQUlSQVFNUkFmL0VBT29BQUFJREFRRUJBUUFBQUFBQUFBQUFBQUFJQkFZSEJRSUJDUUVCQUFJREFRRUJBQUFBQUFBQUFBQUFBQVFIQWdVR0F3Z0JFQUFCQkFJQkFnVURCUUFBQUFBQUFBQUVBUUlEQlFBR0J5QVRFQkVTRkJWQU1TSWhNelVXQ0JFQUFRSURBd2NHQ3djRkFBQUFBQUFBQVFJREVSTUVBQklGSVRGQlVTSXlGQkFnWVVJekZYR0JrYUhCVW1JamN5UUc4TEZ5a2tNME5kR0M0bE1XRWdBQkF3TUNBd2dEQUFBQUFBQUFBQUFCQUJFQ0VERVNJRUh3SVFNd1FGQlJZWUdoSXJFeUV4TUJBQUVEQXdNRUF3RUJBUUFBQUFBQUFSRUFJVEZCVVdFUWNZRWc4Skdoc2NIaDBVRHgvOW9BREFNQkFBSVJBeEVBQUFGL2dBRG40U3ZUOG5aeGdBT05sQ2hmdmhac05vcldXOHBlcjdsayt1b3UrNmJkeWNQVGpaUXNCbFYvdThYdmJCanNFUjViNk5ZSG9xWDd2VDF0anZUOG8wRmYyUGtmengxMTl1ams3anVQYWp4dWpWV3NicWRtMWZuZVRsNUxudHM2TjJWWXRqVE5yWlhRblg2dGYvSHF6SXNQM0cyN2E3dW04c2c5cmd1c3M1dE43UmZaOUlITDBNdU5GOWZ6MWszaTUrNnBUV1BYVTVUQjdmU1puSVRjbzRBRlg4TnhaL2ZUL1NJU3dBUzBnRllPbWFVZE0wbzA0QUE1Wk1KQUFCLy8yZ0FJQVFFQUFRVUM2TE8wQUNDcjdPdUtnNkx5OENBQzFyWmhMRVhQOUliMjBLUGdKWXJQYjluNUpxSzJ6RUxHbkd5OHZBZ0FwWmJtNnVkZTE0T3ZEemtXMFd5MkxnblVRNjdVdVFPUDRiS0hTOTBQcFQvbDZ6NHphWVRwVHRMQnFZYXJPUmIzNC9VUWlvckJ3Z3NNQW1jMHlheXdpcmwySCtsMnRVTVdNaTJWWlpWbG1NVU4vb0xlNitPODREcUlTcnZPUnVSaHFnYlNkSnRkZ3RmNi9UZkRaYTFReFkxUlVEQWlidUl5ejJQaGJVRXA5QnpiK0thbTB1Syt2REZENkx2VE5Yc2NSRThzQk5GSkM4YkdIZjhBMjN3MjZrV1ZsWDhqMW1yd1E4aVNoNmJCc2FLTUpmUTZ0cVg4ejBYWHd2eEFudGZhOUgvLzJnQUlBUUlBQVFVQzZGWHl4RjZVVEZUdzl2M0VhSzVqaHdYUGE1cW91SW1mYkZYd2ZQOEFuRzl5dENOOUdGQ3BLbmJkNmlqeW9DZ3JCaERNbGQ1TmhBZjNrOEJyTHRMSStMMTJGZXdoaUxNRE1DY3doazdWWEIyZnJrc3Zsa2NmcXowcDVaWVY3Q0dWbFkwWm5mWEcvYkh3SXFvblM2TkYrby8vMmdBSUFRTUFBUVVDNklZWFNPbGhjeGVpZWRJMEdKU1JNcjdCQnBMRzdobWdJc0d4dWE1RlRKNTBqUlZmTThjZEkwd0FScklMYU9KazV3UGN3UXRZbDdyZlM0T0thSmdQWThLa2J1enl0N1dQZXJseGRia0xaSEJQNllabFl2NHl0bGlWaTBFc2NXYkFZbmF5cHFWbld4c1dDczl5L3VaRE1yRm1tV1JXVTdHc08vZHdDN2ZDeVdWejNkQTU4MFgxSC8vYUFBZ0JBZ0lHUHdMdHVhZE1kWElybW1OazR1c2QxbEsvd3l5alY2NHlzb3k0Wll5WERFTEtLNWFXcGpKZXUvZ1gvOW9BQ0FFREFnWS9BdEdNYnBwQnRMbXVaaTZhRjB5Y1VjNkIwNWU2STZZWk9McGpaWmJMRk5RQkhxSFpPYUdjTGo1VXVtM3Q2dlZpaktlNkVZbTlNcGZyK1ZqRyt3WDlIKzJnQ0pZb2p5cGhmeVdVcjZmckx2SC8yZ0FJQVFFQkJqOEM1aTZpcWNEVEtJWGxuMmpBWnJUS1o5RDZQV1FvS0htNXBlZVB3MjlLamFLZGg1SGFzNnVrZEhKUVlZRTM1OFg2aUJoQktkbEhsTWZKWXZ0TFdsdWliSzNrNVU1VmJLUVlmYkpacW1LUytxUHpOMzlOSjlQUlpEekt3NDA0SW9XTXhISVhuajhOdlNvMjlaYXQxUFVRaTB0dmFjVjJydWxSNUt1cEtiOU9wY3Rna1JRVU41QjVjOWxWS0dnMjdpUzVpdmhvMlVlaytPeHFhWUJGY2dlQU9BYUQwNmpaVlBVSlVhVXFnK3dkNUN0WXR4azVQQzNiODdxM2JMVFY1LzA0YnQzMmJEaDlwdy91RkhldmYwNUt0NEdEcmlaVFA0M01ubUdXMVBoclNET3FWSWF6YktZNXo0ck5NdGlEYktRaHNleWtRSEl6RCtUUGFCR2FWN2ZUcXRpZDMrTTkzTUtzMHlhamM5TnJpOGhHNHZTRGJVb2ZsVW0weHY4QXVUcEJ0UzRVdFNrQmxFNXhjTmlZNWtBanJBSG5zL2lVUXR1a1JkYVVNb211L3dDTWVTUXhCekVIQnNwemhzSHJLOUFzdW9xRnE0YTlHcXFqdktWNnFlbjdyZDM4T25nN2x5Um9oOXRQSmNYa0kzRjZRYkhTdUVYWFBCYXR4Q1k0dzlWdUVxeXhGMFpFaFNUcUF0U3RLQ1o5VkdwcUZKRnlLbmQzSitBRGthcXdzMDZpZm5BbnJwR3JVYk4wOU8yR21XaEJDQnpZMWRHMjR2OEEyN3EvekpnZVZtb1lYTVpxRUpjWlhyUXNSQnk5SE0rcGkyemovd0QwNWZxK0NlUVgrN3VDdkFvbFpaTVpXNURhdldacDZCR1BzZlRqMkw0Y2lGVXFyYnJFdHFwbnhWbUtqTlMxRXBpVGtqbXNtc0wyTW9MdEhqYldJTGZjcVNodHFsQUZHZHZJZ3czVHBzNjdoNCtvRGdiM2RoeGVieFBIdVJ2R3FOTGY5NUF4RWJuaXlXSXhOdkdSOU84WFc5Mk5MNHcxd1I4dnc4MlY4eGM3VzdlNkk5V3pEQlp4TkdKdDRWUk40RWxzVk1sRlFsZ0NEc3YzWUlkN1NaMWJWUEdJcis4NTlURmErSzRQaDV5cFYwL3Q0UzdzQm56Nlk4Mm83eGs4QkxQRjhUZGtTdE4rL3N3OE5tNUYyVGRFbTVDNWNoa3V3eVFoemYvYUFBZ0JBUU1CUHlIMFo2cnNoQmlMbG9VNzg1YU1tSGoweUlGc0hpbjdhZkZyQmwvSVhSTmNsMkxNNXVQQ3NwWVNHenhsVmlhUlZEbXl5KzlYQ2o4cVpsSFNSQXRnOFUvYlFjREhDUVQ5Qjk5NlBoWUxuOG9hSFRqWHBBVkpHSHlxd2dGenFCK0Nuc1FFZC93TnNQV2lBaDJFM0NhbXRmSTYrVCtabTJhSUNEMkdoNGUycGcyTmtQYTdiUDhBWjZlUk9QVm5NbmhVYXVtUmNCWmNDOWNVYWRFWHdkRXB4RGFOaXovN0k0aW9sY1JTNFdIZDhJNWluQjVSKzBibGVjQTkrS05KZkQrRTFPdlltdVZZbkpkcUVpWENMaVNKc0pkem9nZi9BTi9xUFpHUXJUbktycU9WcS80SDROcm43ek45VTN6MGNIbEg3UnVVbXpOWU5Mb0RZcUxacU9DVU1JamlwbmlDUkF3WVFLYjlBVHJpVEd6Mk1UNXlYME9FZkQ5cnErbHpob2ZuRHkwQUFRRmdNUjBOb0tvZ2ZHZzNYb0JGQ21MT3JTRUE0Sml1ZjdJZW01Q0ZkYTVidFJTa0NiTHBXa0pGT29iN1poTHNiMFBJcmJIZ1NCMmJLNlZBRDBFU01yaERObHlTcEJZaitTSE9saFdOeDZmOVRtM2p1Y0svVHZXK3FJOVAvOW9BQ0FFQ0F3RS9JZlFZbG9YSHBrcVBvdFFZaXBKaFM3SGJtc0NFNlNWWVZQMEJXVDdva3VhUi93RG5yeDNPOWFSMlUvOEFHMTdUajdubXZrVWFqNzExNlREV2Mybno3M29RUjBNcmkrdWY1VndMM1o3SFBGYWdOSFVmZVN0aXA3SEg0NzE4OXpVZmZ6VnAwVTk3cDB4ek5JNWNWMkRwcUEwZFI5NUtpaGQ1ZjV4VE5jbW5NdWt5b0FnOU9UUCtqLy9hQUFnQkF3TUJQeUgwREJsVkprdWJlbjJVYXQ2enFkSlVpa2JSMjNhVDVDV1M1ck8zRm1pbWUvRkdra2Vuc28xeUw2Q282WjFlaFdDeEliM2IzT01WR0VHZSt2OEFsQVAvQUgxNS9qYXRRN3EySzMxR3U0NzcrOXVrajRMdlkvM0htbURMU2UvSG1tT1paK2VnUnhnblh0L2NhZHIwY2haZXhZTjk2a0JTZS9icGdBa0dJeGFOYjkveFYrU2VteC9ZK09tQ2g5Zy9iUVVDM3Njdkg1cnZoTSsvY1c2U0Fyak9sSUFndkZ4ZVJ6UzBES0xFREhIUmZEOUQvbElrbGVuS1FiWlBoLzZQLzlvQURBTUJBQUlSQXhFQUFCQUFESUFBRVVCQUpCaXFCQ25BdFNRaERCT0lDQUFZaUFBQ0FTQUFBQUFmLzlvQUNBRUJBd0UvRVBRMFZ5ZCt6a0pNc2ZWUWRlc29pWk9RS0UxOU4reW1RT1NHNERzQjRFZ0F3dkFzSkJzR0xOblNhelBxeEppUWhSaGlGTzJBOHBycVNRd0VaVHNya094YUZrUytYRGNpbGFhYUx3RWRFd2pjYk4rbCt5bVFPU0c0RHNCNEYvS2xhNVJXOTFkeXQwRkdnQUpBRHpkTnkzS3Ewc0pkY1NuY3lEaHVxeG9FODRkVkFpdzBwYjg3YkFMSllBRUo5QnBiL2tlRVpxalRBYncxOGZYeDZzek5yTmhoVjZ1czEwekg1YXJPVmFWQk1JWUJZTHhHSXZmb1o0UXhDTWlXaEZxcEFGeGxGRTQ0S2pTN04vandBNkxoUkZNa0w0akMyNlU2S29aaEllOCtydEhrZFMrZ0FBdE1tNjhuZUVmaWMzVlBpVkZuSTdKVWZrUXNXdndiT0VvdHA4SXVJRnJ3QWI3VDVIYVFMS0RFREowcEI0RWdKWTlWbE01YUUvN1dYNFFvSjFBTXQ2QUR1VWsyZTZaN3UzZVhTK2dBQXRNbTY4bmVFWTh3bmxSWUtVS1lDN1FNVnNHTWNVc2JGQ1pqUG4zcGdvbG9OaWVnQ1d3N0pKTFdUaWlYRFFPKzRtRDNWV1ZDcUtxcXF2cHZxR1pkdUlsUld3aHhSOWpnMEFXQURvRndnM2hRQUtnZzN1ZWk3ekNqU1VXRWlMbXloSHZCY1JNQUdZdVVhR0JBUlRuSXJxMHlHblc0YjdqM0VzQTRUaFVYVkZ2Z0VaUmgyb29vYzIyQjMzRS9SRm1BMWd2T20wd1NwV0lrMzBmdVVuK2E5cG0xZXg5Z21pMG9pTGVuLzlvQUNBRUNBd0UvRVBSTEdBb3VVSng2WGNGSStPZ0lVaDNudnNVWkV5aEd6KytibENoaEdXcjlITzlPQVVRajBkd1VGQkhMMGlTRG9OaHZhNVQ0bGVKMm9Fa3IyVGpjOGw4Z2tMT0FiUEd6cFdzYm8zVDcxeEY4VTRjQ3hmZFczRnZoY3dHaTZ4Rmw4Si9XQThoVzdEWTgwSUkzV1JaVHZiblZ2UWdNSFJxRlhkbitHL2tYc3k2YlFDUmRTc1dZZmkwMG5DQmMvS054N0NiSUpIM2RGN3I3V2psYkNqQ1h3bmhQNmNEeUVOQTVKTi9pakkwNWJ2OEFPaG5JL3FucWNuZXRJd2lPaWNJRno4bzNIc0pzZ2k1clYzWTBHZzAxY3V4T3hDYlRaT3lWRVhFazNaKytoS2NiOC8yalFRSHB4MHYzL3dCSC85b0FDQUVEQXdFL0VQUXhXWkFSZUJYTUdCcmd0SVY5NU9TM3BldjJOVnNmdDBxVTJQZzVOem9LYWFZN0NzaElMUkpaemVuUFV4aERscTBYSTNweWs1dzBmdDFqYnhRSmdTSjBldjJOVnNmdDByZjZ3ZXdCOTk2eUxYY1gvTmo5OUhDNkFHcFNUcTBhVVY4NEFtSE5BdG9rZ1FTTnFmZ0FQQjJlZG53MncvQnY1RnVjN212ZXRQMnpzajNwbWJacVZTVmY3WHZ4aExZb1RiS3UrK3dmRDdhaHBMZmN3OEtLQ0JSNWIyTWR5dDVwSEpjbmRVdjMwTllSbFlCcGNTR0hZd21MMGhITFVzWnJMN0Q1dkZhSDlUUlBlR3R3RDhyL0FIODlxK0Nqb2xUTHNGcTFnRFZoT2hDOU9QWHlvUzJ4YmRRN3Vob0Z0M0NqNlBnd1h4alRBTURBQmdhR1ZZMVRYZmtaL0VSYU1hRVc2YUg5VFJQZUdnNUVTZ2Q5K1dqSjRpVm11eWdMZUxGRENRU1lURUxDeExPTGJkRU1DRGU1dEhmTml6TnBoczRsc3E2L3pRQ3dXTGVrbU9ZUHlBZHdtbFZsL3dDZi85az1gLFxuICAgICAgICAgICAgICAgIHdpZHRoOiA3MCxcbiAgICAgICAgICAgICAgICBhbGlnbm1lbnQ6ICdjZW50ZXInLFxuICAgICAgICAgICAgICAgIHBhZ2VCcmVhazogJ2FmdGVyJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuICAgICAgICBkb2NEZWZpbml0aW9uLmNvbnRlbnQucHVzaCh7XG4gICAgICAgICAgICB0b2M6IHtcbiAgICAgICAgICAgICAgICB0aXRsZToge1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnVGFibGUgb2YgY29udGVudHMnLFxuICAgICAgICAgICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhbGlnbm1lbnQ6ICdjZW50ZXInLFxuICAgICAgICAgICAgICAgICAgICBmb250U2l6ZTogMTgsXG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogWzEwLCAxMCwgMTAsIDUwXVxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgbnVtYmVyU3R5bGU6IHtcbiAgICAgICAgICAgICAgICAgICAgYm9sZDogdHJ1ZVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBwYWdlQnJlYWs6ICdhZnRlcidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgLy8gQWRkIFJFQURNRSBwYWdlIGlmIGF2YWlsYWJsZVxuXG4gICAgICAgIGRvY0RlZmluaXRpb24uY29udGVudC5wdXNoKHRoaXMuZ2VuZXJhdGVNYXJrZG93bkNvbnRlbnQoKSk7XG5cbiAgICAgICAgLy8gQWRkIENIQU5HRUxPRyBwYWdlIGlmIGF2YWlsYWJsZVxuXG4gICAgICAgIC8vIEFkZCBDT05UUklCVVRJTkcgcGFnZSBpZiBhdmFpbGFibGVcblxuICAgICAgICAvLyBBZGQgTElDRU5TRSBwYWdlIGlmIGF2YWlsYWJsZVxuXG4gICAgICAgIC8vIEFkZCBUT0RPIHBhZ2UgaWYgYXZhaWxhYmxlXG5cbiAgICAgICAgLy8gQWRkIERlcGVuZGVuY2llcyBwYWdlIGlmIGF2YWlsYWJsZVxuXG4gICAgICAgIC8vIEFkZCBBZGRpdGlvbmFsIHBhZ2VzIGlmIGF2YWlsYWJsZVxuXG4gICAgICAgIGRvY0RlZmluaXRpb24uY29udGVudC5wdXNoKHRoaXMuZ2VuZXJhdGVNb2R1bGVzQ29udGVudCgpKTtcblxuICAgICAgICBkb2NEZWZpbml0aW9uLmNvbnRlbnQucHVzaCh0aGlzLmdlbmVyYXRlQ29tcG9uZW50c0NvbnRlbnQoKSk7XG5cbiAgICAgICAgLy8gQ2xhc3Nlc1xuXG4gICAgICAgIC8vIEluamVjdGFibGVzXG5cbiAgICAgICAgLy8gSW50ZXJjZXB0b3JzXG5cbiAgICAgICAgLy8gR3VhcmRzXG5cbiAgICAgICAgLy8gSW50ZXJmYWNlc1xuXG4gICAgICAgIC8vIFBpcGVzXG5cbiAgICAgICAgLy8gTWlzY2VsbGFuZW91c1xuXG4gICAgICAgIC8vIFJvdXRlc1xuXG4gICAgICAgIC8vIENvdmVyYWdlIC0gZG9jRGVmaW5pdGlvbi5jb250ZW50LnB1c2goLi4udGhpcy5jb3ZlcmFnZUVuZ2luZS5jYWxjdWxhdGVUYWJsZSgpKTtcblxuICAgICAgICBsZXQgcGRmRG9jID0gcHJpbnRlci5jcmVhdGVQZGZLaXREb2N1bWVudChkb2NEZWZpbml0aW9uKTtcblxuICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgICAgICAgZnMuZW5zdXJlRmlsZShvdXRwdXRGb2xkZXIgKyBwYXRoLnNlcCArICdkb2N1bWVudGF0aW9uLnBkZicsIGVyciA9PiB7XG4gICAgICAgICAgICAgICAgaWYgKGVycikge1xuICAgICAgICAgICAgICAgICAgICByZWplY3QoYEVycm9yIGR1cmluZyBwZGYgZ2VuZXJhdGlvbjogJHtlcnJ9YCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcGRmRG9jLnBpcGUoXG4gICAgICAgICAgICAgICAgICAgICAgICBmcy5jcmVhdGVXcml0ZVN0cmVhbShvdXRwdXRGb2xkZXIgKyBwYXRoLnNlcCArICdkb2N1bWVudGF0aW9uLnBkZicpXG4gICAgICAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICAgICAgIHBkZkRvYy5lbmQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZSgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGZpcnN0Q2hhcmFjdGVyVXBwZXJDYXNlKHNlbnRlbmNlOiBzdHJpbmcpOiBzdHJpbmcge1xuICAgICAgICByZXR1cm4gc2VudGVuY2UuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzZW50ZW5jZS5zbGljZSgxKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdlbmVyYXRlTWFya2Rvd25Db250ZW50KCkge1xuICAgICAgICBsZXQgcGFnZXMgPSBDb25maWd1cmF0aW9uLm1hcmtEb3duUGFnZXM7XG5cbiAgICAgICAgbGV0IGRhdGEgPSBbXTtcblxuICAgICAgICBwYWdlcy5mb3JFYWNoKHBhZ2UgPT4ge1xuICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBgJHt0aGlzLmZpcnN0Q2hhcmFjdGVyVXBwZXJDYXNlKHBhZ2UubmFtZSl9YCxcbiAgICAgICAgICAgICAgICB0b2NJdGVtOiB0cnVlLFxuICAgICAgICAgICAgICAgIHN0eWxlOiAnaGVhZGVyJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBkYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgIHRleHQ6IE1hcmtkb3duVG9QZGZFbmdpbmUuY29udmVydChwYWdlLm1hcmtkb3duKSxcbiAgICAgICAgICAgICAgICBtYXJnaW46IFswLCAxMF1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLmluc2VydFBhZ2VSZXR1cm4oZGF0YSk7XG5cbiAgICAgICAgcmV0dXJuIGRhdGE7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBpbnNlcnRQYWdlUmV0dXJuKGRhdGEpIHtcbiAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgIHRleHQ6IGAgYCxcbiAgICAgICAgICAgIG1hcmdpbjogWzAsIDAsIDAsIDIwXSxcbiAgICAgICAgICAgIHBhZ2VCcmVhazogJ2FmdGVyJ1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGdlbmVyYXRlTW9kdWxlc0NvbnRlbnQoKSB7XG4gICAgICAgIGxldCBkYXRhID0gW107XG5cbiAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgIHRleHQ6ICdNb2R1bGVzJyxcbiAgICAgICAgICAgIHRvY0l0ZW06IHRydWUsXG4gICAgICAgICAgICBzdHlsZTogJ2hlYWRlcidcbiAgICAgICAgfSk7XG5cbiAgICAgICAgXy5mb3JFYWNoKENvbmZpZ3VyYXRpb24ubWFpbkRhdGEubW9kdWxlcywgbW9kdWxlID0+IHtcbiAgICAgICAgICAgIGRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgdGV4dDogYCR7bW9kdWxlLm5hbWV9YCxcbiAgICAgICAgICAgICAgICBzdHlsZTogJ3N1YmhlYWRlcicsXG4gICAgICAgICAgICAgICAgbWFyZ2luOiBbMCwgMTUsIDAsIDE1XVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgdGV4dDogW1xuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBgRmlsZW5hbWUgOiBgLFxuICAgICAgICAgICAgICAgICAgICAgICAgYm9sZDogdHJ1ZVxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiBtb2R1bGUuZmlsZVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICBtYXJnaW46IFswLCAxMF1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAobW9kdWxlLnJhd2Rlc2NyaXB0aW9uICE9ICcnKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogYERlc2NyaXB0aW9uIDpgLFxuICAgICAgICAgICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtYXJnaW46IFswLCAxMF1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IGAke21vZHVsZS5yYXdkZXNjcmlwdGlvbn1gLFxuICAgICAgICAgICAgICAgICAgICBtYXJnaW46IFswLCA1XVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobW9kdWxlLmRlY2xhcmF0aW9ucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogYERlY2xhcmF0aW9ucyA6YCxcbiAgICAgICAgICAgICAgICAgICAgYm9sZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiBbMCwgMTBdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgbGlzdCA9IHsgdWw6IFtdIH07XG5cbiAgICAgICAgICAgICAgICBfLmZvckVhY2gobW9kdWxlLmRlY2xhcmF0aW9ucywgZGVjbGFyYXRpb24gPT4ge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnVsLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogYCR7ZGVjbGFyYXRpb24ubmFtZX1gXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKGxpc3QpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobW9kdWxlLnByb3ZpZGVycy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogYFByb3ZpZGVycyA6YCxcbiAgICAgICAgICAgICAgICAgICAgYm9sZDogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgbWFyZ2luOiBbMCwgMTBdXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBsZXQgbGlzdCA9IHsgdWw6IFtdIH07XG5cbiAgICAgICAgICAgICAgICBfLmZvckVhY2gobW9kdWxlLnByb3ZpZGVycywgcHJvdmlkZXIgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnVsLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogYCR7cHJvdmlkZXIubmFtZX1gXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKGxpc3QpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAobW9kdWxlLmltcG9ydHMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgICAgIHRleHQ6IGBJbXBvcnRzIDpgLFxuICAgICAgICAgICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBtYXJnaW46IFswLCAxMF1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGxldCBsaXN0ID0geyB1bDogW10gfTtcblxuICAgICAgICAgICAgICAgIF8uZm9yRWFjaChtb2R1bGUuaW1wb3J0cywgaW1wb3J0UmVmID0+IHtcbiAgICAgICAgICAgICAgICAgICAgbGlzdC51bC5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGAke2ltcG9ydFJlZi5uYW1lfWBcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBkYXRhLnB1c2gobGlzdCk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmIChtb2R1bGUuZXhwb3J0cy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogYEV4cG9ydHMgOmAsXG4gICAgICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogWzAsIDEwXVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgbGV0IGxpc3QgPSB7IHVsOiBbXSB9O1xuXG4gICAgICAgICAgICAgICAgXy5mb3JFYWNoKG1vZHVsZS5leHBvcnRzLCBleHBvcnRSZWYgPT4ge1xuICAgICAgICAgICAgICAgICAgICBsaXN0LnVsLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogYCR7ZXhwb3J0UmVmLm5hbWV9YFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGRhdGEucHVzaChsaXN0KTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBgIGAsXG4gICAgICAgICAgICAgICAgbWFyZ2luOiBbMCwgMCwgMCwgMjBdXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgdGhpcy5pbnNlcnRQYWdlUmV0dXJuKGRhdGEpO1xuXG4gICAgICAgIHJldHVybiBkYXRhO1xuICAgIH1cblxuICAgIHByaXZhdGUgZ2VuZXJhdGVDb21wb25lbnRzQ29udGVudCgpIHtcbiAgICAgICAgbGV0IGRhdGEgPSBbXTtcblxuICAgICAgICBkYXRhLnB1c2goe1xuICAgICAgICAgICAgdGV4dDogJ0NvbXBvbmVudHMnLFxuICAgICAgICAgICAgdG9jSXRlbTogdHJ1ZSxcbiAgICAgICAgICAgIHN0eWxlOiAnaGVhZGVyJ1xuICAgICAgICB9KTtcblxuICAgICAgICBfLmZvckVhY2goQ29uZmlndXJhdGlvbi5tYWluRGF0YS5jb21wb25lbnRzLCBjb21wb25lbnQgPT4ge1xuICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBgJHtjb21wb25lbnQubmFtZX1gLFxuICAgICAgICAgICAgICAgIHN0eWxlOiAnc3ViaGVhZGVyJyxcbiAgICAgICAgICAgICAgICBtYXJnaW46IFswLCAxNSwgMCwgMTVdXG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICB0ZXh0OiBbXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGBGaWxlbmFtZSA6IGAsXG4gICAgICAgICAgICAgICAgICAgICAgICBib2xkOiB0cnVlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6IGNvbXBvbmVudC5maWxlXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICAgIG1hcmdpbjogWzAsIDEwXVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmIChjb21wb25lbnQucmF3ZGVzY3JpcHRpb24gIT0gJycpIHtcbiAgICAgICAgICAgICAgICBkYXRhLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICB0ZXh0OiBgRGVzY3JpcHRpb24gOmAsXG4gICAgICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogWzAsIDEwXVxuICAgICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogYCR7Y29tcG9uZW50LnJhd2Rlc2NyaXB0aW9ufWAsXG4gICAgICAgICAgICAgICAgICAgIG1hcmdpbjogWzAsIDVdXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGRhdGEucHVzaCh7XG4gICAgICAgICAgICAgICAgdGV4dDogYCBgLFxuICAgICAgICAgICAgICAgIG1hcmdpbjogWzAsIDAsIDAsIDIwXVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIHRoaXMuaW5zZXJ0UGFnZVJldHVybihkYXRhKTtcblxuICAgICAgICByZXR1cm4gZGF0YTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IEV4cG9ydFBkZkVuZ2luZS5nZXRJbnN0YW5jZSgpO1xuIl19